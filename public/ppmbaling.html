<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <title>PPM Baling | Persekutuan Pengakap Daerah Baling</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="icon" type="image/png" href="assets/favicon.png">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col">

<main class="flex-grow">

<!-- ================= HEADER ================= -->
<header class="bg-green-900 text-white sticky top-0 z-50 shadow">
  <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
    <div class="flex items-center gap-4">
      <img src="assets/logo.png" class="h-14" alt="Logo">
      <div>
        <p class="text-xs uppercase opacity-80">Portal Rasmi</p>
        <h1 class="font-bold text-lg md:text-xl">
          Persekutuan Pengakap Daerah Baling
        </h1>
        <p class="text-xs italic opacity-90">Bersedia ¬∑ Berkhidmat</p>
      </div>
    </div>
  </div>
</header>

<!-- ================= DASHBOARD ================= -->
<section class="max-w-7xl mx-auto px-6 mt-10">

  <div class="grid md:grid-cols-2 gap-6">

    <a href="#"
       onclick="showSection('maklumat-sekolah'); return false;"
       class="bg-white rounded-xl p-6 shadow hover:shadow-md transition flex items-center justify-between md:col-span-2">

      <div class="flex items-center gap-4">
        <div class="bg-gray-100 p-3 rounded-lg text-xl">üè´</div>
        <span class="font-medium">Maklumat Zon & Sekolah</span>
      </div>

      <span class="text-gray-400">‚Ä∫</span>
    </a>

  </div>
</section>

<!-- ================= MAKLUMAT SEKOLAH ================= -->
<section id="maklumat-sekolah"
  class="content-section hidden max-w-7xl mx-auto px-6 mt-16">

  <h3 class="text-2xl font-bold text-green-900 mb-6">
    Maklumat Sekolah Daerah Baling
  </h3>

  <button onclick="hideSection('maklumat-sekolah')"
    class="mb-6 text-sm bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded">
    ‚Üê Kembali
  </button>

  <!-- ================= STATISTIK ================= -->
  <div class="grid md:grid-cols-3 gap-6 mb-10">

    <div class="bg-white rounded-xl shadow p-6 text-center border-t-4 border-slate-800">
      <h2 class="stat-total text-4xl font-bold text-slate-800">0</h2>
      <p class="text-sm text-gray-600 mt-2 uppercase">Jumlah Keseluruhan</p>
    </div>

    <div class="bg-white rounded-xl shadow p-6 text-center border-t-4 border-green-600">
      <h2 class="stat-rendah text-4xl font-bold text-green-600">0</h2>
      <p class="text-sm text-gray-600 mt-2 uppercase">Sekolah Rendah</p>
    </div>

    <div class="bg-white rounded-xl shadow p-6 text-center border-t-4 border-blue-600">
      <h2 class="stat-menengah text-4xl font-bold text-blue-600">0</h2>
      <p class="text-sm text-gray-600 mt-2 uppercase">Sekolah Menengah</p>
    </div>

  </div>

  <!-- ================= FILTER ================= -->
  <div class="bg-white rounded-xl shadow p-6 mb-10">
    <input type="text"
      id="searchInput"
      placeholder="üîç Cari Nama Sekolah, Kod atau PGB..."
      class="w-full border rounded-lg px-4 py-2 mb-4">

    <div class="grid md:grid-cols-4 gap-4">
      <select id="filterDun" class="border rounded-lg px-4 py-2">
        <option value="">Semua DUN</option>
      </select>

      <select id="filterJenis" class="border rounded-lg px-4 py-2">
        <option value="">Semua Jenis</option>
      </select>

      <select id="filterKategori" class="border rounded-lg px-4 py-2">
        <option value="">Semua Kategori</option>
      </select>

      <select id="filterLokasi" class="border rounded-lg px-4 py-2">
        <option value="">Semua Lokasi</option>
      </select>
    </div>
  </div>

  <!-- ================= GRID ================= -->
  <div id="sekolah-grid"
       class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 pb-16">
  </div>

</section>

</main>

<!-- ================= FOOTER ================= -->
<footer class="bg-green-900 text-white text-center text-sm py-6 mt-auto">
  ¬© 2026 Persekutuan Pengakap Daerah Baling
</footer>

<!-- ================= MODAL ================= -->
<div id="modalDetail"
     class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">

  <div class="bg-white w-full max-w-lg rounded-xl shadow-lg p-6 relative">

    <button onclick="tutupDetail()"
      class="absolute top-3 right-4 text-gray-500 hover:text-black text-xl">
      ‚úï
    </button>

    <div id="detailContent"></div>

  </div>
</div>

<!-- ================= SCRIPT ================= -->
<script type="module">

import { initializeApp } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

import { getFirestore, collection, getDocs } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyAU-mdQWJkF9tiyrl6ZxJeGTyfHG2TYSVU",
  authDomain: "ppmdaerahbaling.firebaseapp.com",
  projectId: "ppmdaerahbaling",
  storageBucket: "ppmdaerahbaling.firebasestorage.app",
  messagingSenderId: "336046440771",
  appId: "1:336046440771:web:f26f1be4acc6ec265d6ff6"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let semuaSekolah = [];
window.sekolahFiltered = [];

/* ================= SECTION ================= */

window.showSection = function(id) {
  document.querySelectorAll('.content-section')
    .forEach(sec => sec.classList.add('hidden'));

  const target = document.getElementById(id);
  if (target) {
    target.classList.remove('hidden');
    target.scrollIntoView({ behavior: 'smooth' });
    loadSekolah();
  }
};

window.hideSection = function(id) {
  document.getElementById(id).classList.add('hidden');
  window.scrollTo({ top: 0, behavior: 'smooth' });
};

/* ================= LOAD DATA ================= */

async function loadSekolah() {

  const grid = document.getElementById("sekolah-grid");

  grid.innerHTML = `
    <div class="col-span-full text-center py-10 text-gray-500">
      Memuatkan data sekolah...
    </div>
  `;

  const snapshot = await getDocs(collection(db, "sekolah"));

  semuaSekolah = [];
  snapshot.forEach(doc => semuaSekolah.push(doc.data()));

  isiDropdown();
  paparSekolah();
  kiraStatistik();
}

/* ================= STATISTIK ================= */

function kiraStatistik() {

  document.querySelector(".stat-total").textContent = semuaSekolah.length;

  document.querySelector(".stat-rendah").textContent =
    semuaSekolah.filter(s =>
      (s.jenis || "").toLowerCase().includes("sk")
    ).length;

  document.querySelector(".stat-menengah").textContent =
    semuaSekolah.filter(s =>
      (s.jenis || "").toLowerCase().includes("sm")
    ).length;
}

/* ================= DROPDOWN ================= */

function isiDropdown() {

  const fields = ["dun","jenis","kategori","lokasi"];

  fields.forEach(field => {

    const select = document.getElementById("filter" + field.charAt(0).toUpperCase() + field.slice(1));
    const first = select.options[0].outerHTML;
    select.innerHTML = first;

    [...new Set(semuaSekolah.map(s => s[field]).filter(Boolean))]
      .sort()
      .forEach(val => {
        const opt = document.createElement("option");
        opt.value = val;
        opt.textContent = val;
        select.appendChild(opt);
      });
  });
}

/* ================= PAPAR SEKOLAH ================= */

function paparSekolah() {

  const keyword = document.getElementById("searchInput").value.toLowerCase();
  const dun = document.getElementById("filterDun").value;
  const jenis = document.getElementById("filterJenis").value;
  const kategori = document.getElementById("filterKategori").value;
  const lokasi = document.getElementById("filterLokasi").value;

  sekolahFiltered = semuaSekolah.filter(s => {

    const matchSearch =
      (s.nama || "").toLowerCase().includes(keyword) ||
      (s.kod || "").toLowerCase().includes(keyword) ||
      (s.pgb || "").toLowerCase().includes(keyword);

    return matchSearch &&
      (!dun || s.dun === dun) &&
      (!jenis || s.jenis === jenis) &&
      (!kategori || s.kategori === kategori) &&
      (!lokasi || s.lokasi === lokasi);
  });

  const grid = document.getElementById("sekolah-grid");
  grid.innerHTML = "";

  if (sekolahFiltered.length === 0) {
    grid.innerHTML = `<div class="col-span-full text-center py-10 text-gray-400">
      Tiada sekolah dijumpai.
    </div>`;
    return;
  }

  sekolahFiltered.forEach((s, i) => {
    grid.innerHTML += `
      <div onclick="bukaDetail(${i})"
        class="cursor-pointer bg-white rounded-xl shadow hover:shadow-xl transition p-6">
        <h3 class="font-bold text-lg text-slate-800">${s.nama}</h3>
        <span class="text-xs bg-yellow-400 px-2 py-1 rounded">${s.kod}</span>
        <p class="mt-4 text-sm">üë§ ${s.pgb || "-"}</p>
        <p class="text-sm text-red-500">üìç ${s.lokasi || "-"}, ${s.dun || "-"}</p>
      </div>
    `;
  });
}

/* ================= MODAL ================= */

window.bukaDetail = function(i) {

  const s = sekolahFiltered[i];

  document.getElementById("detailContent").innerHTML = `
    <h3 class="text-xl font-bold mb-4">${s.nama}</h3>
    <p><strong>Kod:</strong> ${s.kod}</p>
    <p><strong>Kategori:</strong> ${s.kategori}</p>
    <p><strong>Jenis:</strong> ${s.jenis}</p>
    <p><strong>DUN:</strong> ${s.dun}</p>
    <p><strong>Lokasi:</strong> ${s.lokasi}</p>
    <p><strong>Alamat:</strong> ${s.alamat}</p>
    <hr class="my-4">
    <p><strong>Nama PGB:</strong> ${s.pgb}</p>
    <p><strong>Telefon PGB:</strong> ${s.telefon_pgb}</p>
    <p><strong>Emel PGB:</strong> ${s.emel_pgb}</p>
  `;

  const modal = document.getElementById("modalDetail");
  modal.classList.remove("hidden");
  modal.classList.add("flex");
};

window.tutupDetail = function() {
  document.getElementById("modalDetail").classList.add("hidden");
};

/* ================= EVENT ================= */

document.addEventListener("DOMContentLoaded", () => {

  ["searchInput","filterDun","filterJenis","filterKategori","filterLokasi"]
  .forEach(id => {
    const el = document.getElementById(id);
    if (el) el.addEventListener("input", paparSekolah);
    if (el) el.addEventListener("change", paparSekolah);
  });

});

</script>

</body>
</html>
